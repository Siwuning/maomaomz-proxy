# 🐱 猫猫的小破烂 - 完整使用教程

---

## ⚙️ 设置页

### 这是什么？

设置页是插件的核心配置中心，你需要在这里配置 API 才能使用大部分功能。同时这里也是配置自动总结的地方。

### API 配置

**什么是 API 配置？**
插件需要调用 AI 接口来执行总结、生成等任务。你需要提供 API 端点和密钥。

**如何配置：**

1. 点击「API 配置」区块展开设置
2. **API 端点**：填写你的 API 地址
   - OpenAI 官方：`https://api.openai.com/v1`
   - 中转站：填写中转站提供的地址，通常以 `/v1` 结尾
   - 本地反代：`http://127.0.0.1:端口号/v1`
3. **API 密钥**：填写你的 API Key（本地反代可以留空或填任意值）
4. **模型选择**：输入模型名称
   - 推荐：`gpt-4o-mini`、`gpt-4o`、`gemini-2.0-flash`、`claude-3-5-sonnet`
   - 根据你的 API 支持的模型填写
5. 点击「保存配置」

**使用 SillyTavern 的 API：**
如果你不想单独配置，可以勾选「使用 SillyTavern API」，插件会直接使用酒馆已配置的 API。

### 自动总结配置

**什么是自动总结？**
当聊天达到设定的楼层数时，插件会自动调用 AI 对这些消息进行摘要总结，帮助你：

- 回顾剧情发展
- 将总结写入世界书，让 AI 记住之前的内容
- 隐藏已总结的楼层，节省 token

**如何配置：**

1. 点击「自动总结设置」区块展开
2. **启用自动总结**：打开开关
3. **总结间隔**：设置每隔多少层触发一次总结
   - 默认 50 层，即每 50 条消息总结一次
   - 建议范围：30-100 层
   - 数值越小总结越频繁，但会消耗更多 API 调用
4. **自动绑定到世界书**（可选）：
   - 开启后，总结完成会自动创建一个世界书，并将总结作为条目写入
   - 世界书会自动绑定到当前聊天
5. **自动隐藏已总结楼层**（可选）：
   - 开启后，已总结的消息会被隐藏，不再占用 token
   - **保留上文层数**：设置保留最近多少层不隐藏，作为上下文衔接
   - 例如设置为 10，则隐藏时会保留最近 10 层消息
6. 点击「保存」

### 手动总结

**什么时候用？**
如果你想手动总结特定范围的消息，而不是等待自动触发。

**如何使用：**

1. 点击「手动总结」区块展开
2. 填写**起始楼层**和**结束楼层**
   - 楼层从 0 开始计数，0 是 AI 的开场白
3. 点击「开始总结」
4. 等待 AI 生成总结
5. 总结完成后可以：
   - 复制总结内容
   - 绑定到世界书

---

## 📝 历史总结

### 这是什么？

这里记录了所有自动总结和手动总结的历史，方便你查看和管理。

### 查看历史

- 切换到「历史总结」标签页
- 每条记录显示：
  - 楼层范围（如：0-49）
  - 总结内容摘要
  - 生成时间

### 操作选项

每条记录右侧有操作按钮：

**复制**

- 点击「复制」将总结内容复制到剪贴板
- 可以粘贴到任何地方使用

**绑定到世界书**

- 点击「绑定」按钮
- 选择目标世界书（或创建新的）
- 总结会作为一个条目添加到世界书
- 条目设置为「常驻」模式，始终生效

**删除**

- 点击「删除」移除这条记录
- 注意：删除历史记录不会影响已绑定的世界书条目

### 清空历史

- 点击「清空历史」按钮可以删除所有记录
- 会有确认弹窗，防止误操作

---

## 📊 状态栏生成器

### 这是什么？

可视化创建角色状态栏的工具。状态栏可以追踪角色的各种属性（好感度、HP、心情等），让 AI 在回复时参考这些状态。

### 基本使用

**添加字段**

1. 点击「添加字段」按钮
2. 填写字段信息：
   - **字段名称**：如「好感度」「HP」「心情」
   - **字段类型**：
     - `文本`：普通文字，适合描述性内容
     - `数值`：数字类型，适合数值属性
     - `进度条`：百分比显示，适合 HP、MP 等
     - `枚举`：固定选项，适合心情状态等
   - **初始值**：字段的默认值
   - **描述**（可选）：给 AI 的说明

**编辑字段**

- 点击字段卡片进行编辑
- 拖拽字段卡片调整顺序
- 点击删除按钮移除字段

**预览效果**

- 右侧实时显示状态栏的预览效果
- 可以切换 JSON / XML 格式查看

### 导出使用

**复制世界书**

- 点击「复制世界书」按钮
- 会生成完整的世界书条目代码
- 粘贴到 SillyTavern 的世界书中
- 条目包含：
  - 状态栏结构定义
  - 初始值
  - AI 指令（如何更新状态）

**复制 Regex**

- 点击「复制 Regex」按钮
- 生成正则替换代码
- 在 SillyTavern 的 Regex 设置中使用
- 可以实现状态栏的美化显示

### 模板功能

**加载模板**

- 点击「模板」按钮查看预设模板
- 包含常用的状态栏配置
- 选择后会自动填充字段

**保存模板**

- 配置好字段后可以保存为自定义模板
- 下次可以快速加载

### AI 优化

- 点击「AI 优化」按钮
- AI 会分析你的字段设计并给出优化建议
- 可以自动补充遗漏的字段

---

## 🎨 前端界面生成器

### 这是什么？

使用 HTML/CSS 自定义聊天界面的工具。可以创建独特的视觉效果，比如卡片式布局、特殊边框、背景等。

### 基本使用

**加载示例**

1. 点击「加载示例」按钮
2. 选择一个预设模板
3. 代码会自动填充到编辑器
4. 右侧显示预览效果

**编辑代码**

- 左侧是代码编辑器
- 可以修改 HTML 结构和 CSS 样式
- 修改后右侧实时预览

**支持的变量**
在代码中可以使用以下变量，会被实际内容替换：

- `{{char}}` - 角色名称
- `{{user}}` - 用户名称
- `{{message}}` - 消息内容
- `{{time}}` - 时间戳

### 导出使用

**复制到 Regex**

1. 点击「复制到 Regex」按钮
2. 打开 SillyTavern 的 Regex 设置
3. 创建新的 Regex 脚本
4. 粘贴代码
5. 设置触发条件（如 `/【界面】/g`）
6. 启用脚本

**使用方法**
在聊天中，当 AI 的回复包含触发词（如「【界面】」）时，会自动应用你设计的界面样式。

### AI 生成

- 在输入框描述你想要的界面效果
- 点击「AI 生成」
- AI 会生成对应的 HTML/CSS 代码

---

## 🧰 AI 工具箱

### 这是什么？

多种 AI 驱动的文本处理工具，帮助你优化创作内容。

### 反八股工具

**什么是八股文？**
AI 生成的文本常有套路化表达，如：

- 「他的眼眸中闪烁着复杂的光芒」
- 「空气中弥漫着一丝微妙的气息」
- 「嘴角勾起一抹意味深长的笑容」

**如何使用：**

1. 点击展开「反八股工具」
2. 在文本框粘贴要处理的内容
3. 点击「开始处理」
4. AI 会重写文本，去除套路化表达
5. 复制处理后的结果

### 文本润色

**功能：**
优化文本表达，使其更流畅、更有文采。

**如何使用：**

1. 点击展开「文本润色」
2. 粘贴原始文本
3. 选择润色风格：
   - 文艺风：更有诗意
   - 口语化：更自然亲切
   - 正式风：更书面规范
4. 点击「润色」
5. 查看并复制结果

### 角色卡优化

**功能：**
优化角色描述，使角色更生动立体。

**如何使用：**

1. 点击展开「角色卡优化」
2. 粘贴角色描述
3. 点击「优化」
4. AI 会给出优化建议和改写版本
5. 可以选择采纳全部或部分建议

### 世界书生成

**功能：**
根据描述自动生成世界书条目。

**如何使用：**

1. 点击展开「世界书生成」
2. 描述你想要的世界观设定
3. 点击「生成」
4. AI 会生成结构化的世界书条目
5. 复制并导入到 SillyTavern

---

## 💬 开场白管理器

### 这是什么？

批量管理角色卡开场白的工具。支持一个角色有多个开场白，方便切换不同剧情开局。

### 基本使用

**选择角色**

1. 点击顶部的角色下拉框
2. 选择要编辑的角色
3. 自动加载该角色的所有开场白

**查看开场白**

- 左侧列表显示所有开场白
- 点击某个开场白在右侧显示完整内容
- 当前使用的开场白会有标记

**添加开场白**

1. 点击「添加开场白」按钮
2. 在编辑器中输入内容
3. 点击「保存」

**编辑开场白**

1. 点击要编辑的开场白
2. 在右侧编辑器修改内容
3. 点击「保存」

**删除开场白**

1. 点击开场白右侧的删除按钮
2. 确认删除

**调整顺序**

- 拖拽开场白卡片调整顺序
- 第一个开场白是默认使用的

### AI 功能

**AI 生成开场白**

1. 点击「AI 生成」按钮
2. 描述你想要的开场白风格或场景
3. AI 会生成新的开场白
4. 可以编辑后保存

**AI 改写开场白**

1. 选中一个开场白
2. 点击「AI 改写」
3. 选择改写方向（更详细/更简洁/换风格）
4. 查看改写结果

### 批量操作

**导出开场白**

- 点击「导出」将所有开场白导出为 JSON 文件
- 可用于备份或分享

**导入开场白**

- 点击「导入」选择 JSON 文件
- 会添加到现有开场白列表

---

## 🔮 MVU Beta - 变量结构生成器

### 这是什么？

MVU（Model-View-Update）是一种让 AI 追踪和更新变量的方法。这个工具帮你生成符合 MVU 规范的变量结构和提示词。

### 核心概念

**InitVar（初始变量）**
定义要追踪的变量及其初始值，放在首消息中让 AI 知道有哪些变量。

**COT（思维链提示）**
指导 AI 在每次回复时如何思考和更新变量，放在作者注或系统提示中。

### 使用步骤

**第一步：生成 InitVar**

1. 在输入框描述你的需求
   - 例如：「我需要追踪角色的好感度（0-100）、信任度（0-100）、当前心情、最近发生的重要事件」
2. 点击「AI 生成」
3. 查看生成的变量结构
4. 可以手动调整变量名称、类型、初始值

**第二步：生成 COT 提示词**

1. 确认 InitVar 结构正确
2. 点击「生成 COT 提示词」
3. AI 会根据你的变量生成对应的思维链指令
4. 可以手动调整提示词内容

**第三步：复制使用**

1. **复制 InitVar**
   - 点击「复制 InitVar」按钮
   - 粘贴到角色卡的「首消息」中
   - 或创建一个世界书条目设为「首消息前」
2. **复制 COT**
   - 点击「复制 COT」按钮
   - 粘贴到「作者注」（Author's Note）
   - 或创建世界书条目设为「作者注后」

### 使用效果

配置完成后，AI 会：

1. 在每次回复前思考变量变化
2. 在回复末尾输出更新后的变量状态
3. 下次回复时参考上次的变量值

---

## ⚡ 偏好设置

### 这是什么？

自定义插件的界面和行为，打造专属的使用体验。

### 界面设置

**刷新时自动弹出面板**

- 开启：页面刷新后自动打开插件面板
- 关闭：需要手动点击按钮打开

**显示任务中心**

- 开启：右下角显示任务进度浮窗
- 关闭：隐藏任务中心

**显示最小化图标**

- 开启：右上角显示猫猫头快捷图标
- 关闭：隐藏图标，通过顶部按钮打开

**设置区块默认展开**

- 开启：打开设置页时所有区块默认展开
- 关闭：默认折叠，需要点击展开

### 主题设置

**主题色**

- 8 种预设颜色可选
- 点击色块即可切换
- 支持自定义颜色（颜色选择器或输入色值）

**渐变色模式**

- 开启后可以设置双色渐变
- 可调整渐变角度（0-360度）
- 实时预览渐变效果

**背景图片**

- 点击「上传图片」选择背景
- 支持调整透明度（10%-80%）
- 点击「清除背景」恢复默认

### 通知设置

**显示成功通知**

- 开启：操作成功时显示绿色提示
- 关闭：静默处理

**显示错误通知**

- 开启：操作失败时显示红色提示
- 建议保持开启，方便排查问题

### 教程设置

**重新显示所有教程**

- 点击按钮后，所有页面顶部的快速上手教程会重新显示
- 适合忘记某个功能怎么用的时候

### 恢复默认

- 点击「恢复默认」按钮
- 所有偏好设置恢复到初始状态
- 会有确认弹窗

---

## ❓ 常见问题

### API 相关

**Q: API 配置失败怎么办？**

1. 检查端点格式是否正确
   - 必须是完整 URL，如 `https://api.openai.com/v1`
   - 注意结尾是否需要 `/v1`
2. 检查 API Key 是否有效
   - 确认 Key 没有过期
   - 确认 Key 有对应模型的权限
3. 如果是本地反代
   - 确保反代服务正在运行
   - 检查端口是否正确

**Q: 调用 API 报错 401/403？**

- API Key 无效或过期
- 检查是否复制完整（有些 Key 很长）

**Q: 调用 API 报错 429？**

- 请求太频繁，触发了限流
- 等待一段时间后重试

### 自动总结相关

**Q: 自动总结没有触发？**

1. 确认「启用自动总结」开关已打开
2. 检查当前楼层数是否达到设定的间隔
   - 例如间隔 50，需要 50 层才触发

**Q: 总结内容不准确？**

- 尝试更换模型（更强的模型效果更好）
- 调整总结间隔（范围太大可能遗漏细节）

**Q: 自动隐藏把重要消息隐藏了？**

- 增加「保留上文层数」的数值
- 或关闭自动隐藏，手动管理

### 世界书相关

**Q: 世界书条目没有生效？**

1. 确认世界书已绑定到当前聊天
   - 在 SillyTavern 的世界书管理中检查
2. 检查条目的触发设置
   - 「常驻」条目始终生效
   - 关键词触发需要消息中包含关键词
3. 刷新页面后重试

**Q: 总结写入世界书后找不到？**

- 世界书名称格式：`总结_角色名_日期`
- 在 SillyTavern 的世界书管理中搜索

### 其他问题

**Q: 插件加载失败？**

1. 检查 SillyTavern 版本是否兼容
2. 尝试清除浏览器缓存后刷新
3. 检查控制台是否有错误信息

**Q: 界面显示异常？**

- 尝试在偏好设置中「恢复默认」
- 清除浏览器缓存
- 检查是否与其他插件冲突

---

*有其他问题？在 Discord 帖子里提问，会有人帮助你！* 🐱
